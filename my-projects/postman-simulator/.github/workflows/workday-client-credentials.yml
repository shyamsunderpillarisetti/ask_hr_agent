name: Fetch Workday token (Client Credentials)

on:
  workflow_dispatch: {}
  push:
    branches: [main]

jobs:
  fetch-token:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch access token via client_credentials
        env:
          WORKDAY_CLIENT_ID: ${{ secrets.WORKDAY_CLIENT_ID }}
          WORKDAY_CLIENT_SECRET: ${{ secrets.WORKDAY_CLIENT_SECRET }}
          TOKEN_URL: https://wd5-impl-services1.workday.com/ccx/oauth2/michaels1/token
        run: |
          echo "Requesting token from $TOKEN_URL"
          resp=$(curl -s -u "$WORKDAY_CLIENT_ID:$WORKDAY_CLIENT_SECRET" \
            -d 'grant_type=client_credentials' \
            -H 'Content-Type: application/x-www-form-urlencoded' \
            "$TOKEN_URL")
          echo "Response: $resp"
          # expose response to later steps
          echo "token=$resp" >> $GITHUB_OUTPUT
